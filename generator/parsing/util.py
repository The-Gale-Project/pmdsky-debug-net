import re

import ruamel.yaml

C_TYPE_MAP = {
    "uint8_t": "u1",
    "uint16_t": "u2",
    "uint32_t": "u4",
    "uint64_t": "u8",
    "int8_t": "s1",
    "int16_t": "s2",
    "int32_t": "s4",
    "int64_t": "s8",
    "char": "s1",
    "short": "s2",
    "int": "s4",
    "uint": "u4",
    "long": "s8",
    "float": "f4",
    "double": "f8",
    "WORD": "u2",
    "DWORD": "u4",
    "size_t": "u4",
    "wchar_t": "u2",
    "__s32": "s4",
    "__s64": "s8",
}

UNMAPPED_SYMBOLS = [
    # ARM9
    "SECURE",
    "AVAILABLE_ITEMS_IN_GROUP_TABLE",
    "EXCLUSIVE_ITEM_DEFENSE_BOOSTS",
    "EXCLUSIVE_ITEM_SPECIAL_ATTACK_BOOSTS",
    "EXCLUSIVE_ITEM_SPECIAL_DEFENSE_BOOSTS",
    "EXCLUSIVE_ITEM_STAT_BOOST_DATA_INDEXES",
    "RECYCLE_SHOP_ITEM_LIST",
    "MISSION_FLOOR_RANKS_AND_ITEM_LISTS_1",
    "MISSION_FLOOR_RANKS_AND_ITEM_LISTS_2",
    "REMOTE_STRINGS",
    "RANK_STRINGS_1",
    "RANK_STRINGS_2",
    "RANK_STRINGS_3",
    "LEVEL_LIST",
    "ACTOR_LIST",
    "GAME_STATE_VALUES",
    "DUNGEON_MOVE_TABLES",
    "LANGUAGE_INFO_DATA",
    "ARM9_UNKNOWN_TABLE__NA_2097FF8",
    "ARM9_UNKNOWN_TABLE__NA_209E12C",
    "ARM9_UNKNOWN_TABLE__NA_209E164",
    "ARM9_UNKNOWN_TABLE__NA_209E280",
    "ARM9_UNKNOWN_DATA__NA_209E6BC",
    "ARM9_UNKNOWN_DATA__NA_209EAAC",
    "ARM9_UNKNOWN_TABLE__NA_20A20B0",
    "ARM9_UNKNOWN_PTR__NA_20A2C84",
    "ARM9_UNKNOWN_TABLE__NA_20A3CC8",
    "ARM9_UNKNOWN_TABLE__NA_20A3CE4",
    "ARM9_UNKNOWN_TABLE__NA_20A68BC",
    "ARM9_UNKNOWN_FUNCTION_TABLE__NA_20A3CF4",
    "ARM9_UNKNOWN_TABLE__NA_20AE924",
    # OVERLAY01
    "PRINTS_STRINGS",
    "PRINTS_STRUCT",
    "CONTINUE_CHOICE",
    "SUBMENU",
    "MAIN_MENU",
    # OVERLAY11
    "UNIONALL_RAM_ADDRESS",
    "GROUND_STATE_MAP",
    "GROUND_STATE_WEATHER",
    "OVERLAY11_UNKNOWN_TABLE__NA_2316A38",
    # OVERLAY13
    "QUIZ_BORDER_COLOR_TABLE",
    "PORTRAIT_ATTRIBUTES",
    "QUIZ_MALE_FEMALE_BOOST_TABLE",
    "STARTERS_TYPE_INCOMPATIBILITY_TABLE",
    "OVERLAY13_UNKNOWN_STRUCT__NA_238C024",
    "OVERLAY13_UNKNOWN_POINTER__NA_238CEA0",
    "OVERLAY13_UNKNOWN_STRUCT__NA_238CF14",
    "OVERLAY13_RESERVED_SPACE",
    # OVERLAY15
    "OVERLAY15_UNKNOWN_POINTER__NA_238B180",
    "OVERLAY15_RESERVED_SPACE",
    # OVERLAY16
    "OVERLAY16_UNKNOWN_POINTER__NA_238CE40",
    "OVERLAY16_UNKNOWN_POINTER__NA_238CE58",
    "OVERLAY16_RESERVED_SPACE",
    # OVERLAY17
    "OVERLAY17_UNKNOWN_POINTER__NA_238BE00",
    "OVERLAY17_UNKNOWN_POINTER__NA_238BE04",
    "OVERLAY17_UNKNOWN_POINTER__NA_238BE08",
    "OVERLAY17_RESERVED_SPACE",
    # OVERLAY18
    "OVERLAY18_UNKNOWN_POINTER__NA_238D620",
    "OVERLAY18_UNKNOWN_POINTER__NA_238D624",
    "OVERLAY18_UNKNOWN_POINTER__NA_238D628",
    "OVERLAY18_RESERVED_SPACE",
    # OVERLAY19
    "OVERLAY19_UNKNOWN_TABLE__NA_238DAE0",
    "OVERLAY19_UNKNOWN_STRING_IDS__NA_238E178",
    "OVERLAY19_UNKNOWN_STRUCT__NA_238E1A4",
    "OVERLAY19_UNKNOWN_STRING_IDS__NA_238E1CC",
    "OVERLAY19_UNKNOWN_STRING_IDS__NA_238E238",
    "OVERLAY19_UNKNOWN_POINTER__NA_238E360",
    "OVERLAY19_UNKNOWN_POINTER__NA_238E364",
    "OVERLAY19_RESERVED_SPACE",
    # OVERLAY20
    "OVERLAY20_UNKNOWN_POINTER__NA_238CF7C",
    "OVERLAY20_UNKNOWN_TABLE__NA_238D014",
    "OVERLAY20_UNKNOWN_POINTER__NA_238D120",
    "OVERLAY20_UNKNOWN_POINTER__NA_238D124",
    "OVERLAY20_UNKNOWN_POINTER__NA_238D128",
    "OVERLAY20_UNKNOWN_POINTER__NA_238D12C",
    "OVERLAY20_RESERVED_SPACE",
    # OVERLAY21
    "OVERLAY21_JP_STRING",
    "OVERLAY21_UNKNOWN_STRING_IDS",
    "OVERLAY21_UNKNOWN_POINTER__NA_238CF40",
    "OVERLAY21_UNKNOWN_POINTER__NA_238CF44",
    "OVERLAY21_RESERVED_SPACE",
    # OVERLAY22
    "OVERLAY22_UNKNOWN_STRING_IDS",
    "OVERLAY22_UNKNOWN_STRUCT__NA_238E85C",
    "OVERLAY22_UNKNOWN_POINTER__NA_238EC60",
    "OVERLAY22_UNKNOWN_POINTER__NA_238EC68",
    "OVERLAY22_UNKNOWN_POINTER__NA_238EC70",
    "OVERLAY22_UNKNOWN_POINTER__NA_238EC64",
    "OVERLAY22_UNKNOWN_POINTER__NA_238EC6C",
    "OVERLAY22_RESERVED_SPACE",
    # OVERLAY23
    "OVERLAY23_UNKNOWN_STRING_IDS",
    "OVERLAY23_UNKNOWN_VALUE__NA_238D2E8",
    "OVERLAY23_UNKNOWN_VALUE__NA_238D2EC",
    "OVERLAY23_UNKNOWN_STRUCT__NA_238D2F0",
    "OVERLAY23_UNKNOWN_POINTER__NA_238D8A0",
    "OVERLAY23_RESERVED_SPACE",
    # OVERLAY24
    "OVERLAY24_UNKNOWN_STRING_IDS",
    "OVERLAY24_UNKNOWN_STRUCT__NA_238C508",
    "OVERLAY24_UNKNOWN_STRUCT__NA_238C514",
    "OVERLAY24_UNKNOWN_POINTER__NA_238C600",
    "OVERLAY24_RESERVED_SPACE",
    # OVERLAY25
    "OVERLAY25_UNKNOWN_STRING_IDS",
    "OVERLAY25_UNKNOWN_STRUCT__NA_238B498",
    "OVERLAY25_UNKNOWN_POINTER__NA_238B5E0",
    "OVERLAY25_RESERVED_SPACE",
    # OVERLAY26
    "OVERLAY26_UNKNOWN_TABLE__NA_238AE20",
    "OVERLAY26_UNKNOWN_POINTER__NA_238AF60",
    "OVERLAY26_UNKNOWN_POINTER__NA_238AF64",
    "OVERLAY26_UNKNOWN_POINTER__NA_238AF68",
    "OVERLAY26_UNKNOWN_POINTER__NA_238AF6C",
    "OVERLAY26_UNKNOWN_POINTER5__NA_238AF70",
    "OVERLAY26_RESERVED_SPACE",
    # OVERLAY27
    "OVERLAY27_UNKNOWN_VALUE__NA_238C948",
    "OVERLAY27_UNKNOWN_VALUE__NA_238C94C",
    "OVERLAY27_UNKNOWN_STRUCT__NA_238C950",
    "OVERLAY27_UNKNOWN_POINTER__NA_238CE80",
    "OVERLAY27_UNKNOWN_POINTER__NA_238CE84",
    "OVERLAY27_UNKNOWN_STRING_IDS",
    "OVERLAY27_RESERVED_SPACE",
    # OVERLAY30
    "OVERLAY30_JP_STRING_1",
    "OVERLAY30_JP_STRING_2",
    # OVERLAY31
    "OVERLAY31_JP_STRING",
    "OVERLAY31_UNKNOWN_STRING_IDS",
    "OVERLAY31_UNKNOWN_STRUCT__NA_2389E30",
    "OVERLAY31_UNKNOWN_STRUCT__NA_2389EF0",
    "OVERLAY31_UNKNOWN_STRUCT__NA_2389FE8",
    "OVERLAY31_UNKNOWN_STRUCT__NA_238A144",
    "OVERLAY31_UNKNOWN_STRUCT__NA_238A190",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A260",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A268",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A26C",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A270",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A27C",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A280",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A284",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A288",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A28C",
    "OVERLAY31_UNKNOWN_VALUE__NA_238A264",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A274",
    "OVERLAY31_UNKNOWN_POINTER__NA_238A278",
    "OVERLAY31_RESERVED_SPACE",
    # OVERLAY34
    "OVERLAY34_UNKNOWN_STRUCT__NA_22DD014",
    "OVERLAY34_UNKNOWN_STRUCT__NA_22DD03C",
    "OVERLAY34_UNKNOWN_POINTER__NA_22DD080",
    "OVERLAY34_UNKNOWN_POINTER__NA_22DD084",
    "OVERLAY34_UNKNOWN_POINTER__NA_22DD08C",
    "OVERLAY34_UNKNOWN_POINTER__NA_22DD088",
    "OVERLAY34_UNKNOWN_POINTER__NA_22DD090",
    "OVERLAY34_RESERVED_SPACE",
    # RAM
    "DRIVER_WORK",
]

HEADER_DIR = "_pmdsky-debug/headers"
SYMBOL_DIR = "_pmdsky-debug/symbols"

OUTPUT_DIR = "../gale_kaitai"

yaml = ruamel.yaml.YAML()


def normalize_name(name: str) -> str:
    return re.sub(r"[\s]+", "_", name.strip().lower().lstrip("_"))


def to_snake_case(s: str) -> str:
    # Replace hyphens with spaces, then apply regular expression substitutions for title case conversion
    # and add an underscore between words, finally convert the result to lowercase
    return "_".join(re.sub("([A-Z][a-z]+)", r" \1", re.sub("([A-Z]+)", r" \1", s.replace("-", " "))).split()).lower()
